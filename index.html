<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PDF Library with search, categories, favorites, and more">
    <title>PDF Library</title>
    <!-- Critical CSS Inlined for above-the-fold content -->
    <style>
        /* Critical CSS for initial render */
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;line-height:1.6;color:#212529;background-color:#f5f7ff;min-height:100vh;padding-bottom:2rem;transition:background-color .3s ease,color .3s ease}header{background:linear-gradient(135deg,#4361ee,#3f37c9);color:white;padding:1.5rem 2rem;box-shadow:0 4px 6px rgba(0,0,0,.1);position:sticky;top:0;z-index:100}.header-content{max-width:1200px;margin:0 auto;display:flex;flex-direction:column;gap:1rem}.logo-container{display:flex;justify-content:space-between;align-items:center}.logo{display:flex;align-items:center;gap:1rem}.logo i{font-size:2.5rem}.logo h1{font-size:2rem;font-weight:700}.theme-toggle{background:rgba(255,255,255,.2);border:none;width:40px;height:40px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.theme-toggle:hover{background:rgba(255,255,255,.3)}.search-container{position:relative;max-width:600px;width:100%}.search-container input{width:100%;padding:.8rem 1rem .8rem 3rem;border-radius:50px;border:1px solid #dee2e6;background-color:#f8f9fa;color:#212529;font-size:1rem;box-shadow:0 4px 6px rgba(0,0,0,.1);transition:all .3s ease}.search-container input::placeholder{color:#6c757d}.search-container input:focus{outline:none;box-shadow:0 0 0 3px rgba(67,97,238,.3)}.search-container i{position:absolute;left:1.2rem;top:50%;transform:translateY(-50%);color:#6c757d}.controls{display:flex;flex-wrap:wrap;gap:1rem;padding:1rem 2rem;background-color:white;box-shadow:0 4px 6px rgba(0,0,0,.1);margin-top:1rem}.filters{display:flex;flex-wrap:wrap;gap:.8rem;flex:1;min-width:300px}.sort-controls{display:flex;gap:.8rem;align-items:center}.sort-label{font-weight:600;white-space:nowrap}.filter-btn,.sort-select{padding:.5rem 1rem;background-color:#f8f9fa;border:1px solid #dee2e6;border-radius:50px;cursor:pointer;transition:all .3s ease;font-weight:600;color:#212529}.sort-select{border-radius:8px;padding:.5rem;min-width:120px}.filter-btn:hover,.filter-btn.active{background-color:#4361ee;color:white;border-color:#4361ee}.container{max-width:1200px;margin:2rem auto;padding:0 1.5rem}.stats{display:flex;justify-content:space-between;margin-bottom:1.5rem;padding:1rem;background:white;border-radius:8px;box-shadow:0 4px 6px rgba(0,0,0,.1);color:#212529}.pdf-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.5rem}.pdf-card{background:white;border-radius:8px;overflow:hidden;box-shadow:0 4px 6px rgba(0,0,0,.1);transition:all .3s ease;display:flex;flex-direction:column;height:100%}.pdf-card:hover{transform:translateY(-5px);box-shadow:0 10px 20px rgba(0,0,0,.15)}.pdf-icon{background:linear-gradient(135deg,#4361ee,#4cc9f0);padding:1.5rem;text-align:center;color:white;position:relative}.favorite-btn{position:absolute;top:10px;right:10px;background:rgba(255,255,255,.3);border:none;width:30px;height:30px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;color:white}.favorite-btn.favorited{background:rgba(255,215,0,.8);color:#333}.pdf-icon i{font-size:3rem}.pdf-content{padding:1.2rem;flex-grow:1;display:flex;flex-direction:column}.pdf-title{font-size:1.2rem;font-weight:700;margin-bottom:.5rem;color:#212529}.pdf-meta{display:flex;justify-content:space-between;margin:.5rem 0;font-size:.85rem;color:#6c757d}.pdf-category{display:inline-block;background-color:#f8f9fa;padding:.2rem .6rem;border-radius:50px;font-size:.8rem;font-weight:600;color:#212529}.pdf-description{color:#6c757d;font-size:.9rem;margin:.8rem 0;flex-grow:1}.pdf-actions{display:flex;gap:.5rem;margin-top:auto}.btn{padding:.6rem 1rem;border-radius:8px;font-weight:600;cursor:pointer;transition:all .3s ease;text-align:center;flex:1;text-decoration:none;display:inline-block;border:1px solid transparent}.btn-primary{background-color:#4361ee;color:white}.btn-primary:hover{background-color:#3f37c9}.btn-outline{background-color:transparent;color:#4361ee;border-color:#4361ee}.btn-outline:hover{background-color:#f8f9fa}.empty-state{text-align:center;padding:3rem;grid-column:1/-1}.empty-state i{font-size:4rem;color:#e9ecef;margin-bottom:1.5rem}.empty-state h3{font-size:1.5rem;margin-bottom:1rem;color:#212529}.empty-state p{color:#6c757d;max-width:500px;margin:0 auto}.pagination{display:flex;justify-content:center;gap:.5rem;margin-top:2rem}.page-btn{padding:.5rem 1rem;background-color:#f8f9fa;border:1px solid #dee2e6;color:#212529;cursor:pointer;border-radius:8px;transition:all .3s ease}.page-btn.active{background-color:#4361ee;color:white;border-color:#4361ee}.page-btn:hover:not(.active){background-color:#f8f9fa}.upload-section{background:white;padding:2rem;border-radius:8px;margin:2rem 0;box-shadow:0 4px 6px rgba(0,0,0,.1);display:none}.upload-section h3{margin-bottom:1rem;color:#212529}.upload-form{display:flex;gap:1rem;flex-wrap:wrap}.upload-input{flex:1;min-width:200px}.upload-input input,.upload-input select{width:100%;padding:.8rem;border:1px solid #dee2e6;border-radius:8px;background-color:#f8f9fa;color:#212529}.loading{text-align:center;padding:2rem;grid-column:1/-1}.loading i{font-size:2rem;color:#4361ee;margin-bottom:1rem;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.error-state{text-align:center;padding:3rem;grid-column:1/-1}.error-state i{font-size:4rem;color:#f87171;margin-bottom:1.5rem}.error-state h3{font-size:1.5rem;margin-bottom:1rem;color:#212529}.error-state p{color:#6c757d;max-width:500px;margin:0 auto}footer{text-align:center;padding:2rem;color:#6c757d;font-size:.9rem}@media (max-width:768px){.header-content{padding:0 1rem}.controls{padding:1rem;flex-direction:column}.filters{width:100%}.sort-controls{width:100%;justify-content:space-between}.stats{flex-direction:column;gap:.8rem}.pdf-grid{grid-template-columns:1fr}.pagination{flex-wrap:wrap}.page-btn{min-width:40px;padding:.4rem .6rem;font-size:.9rem}}@media (max-width:480px){header{padding:1rem}.logo h1{font-size:1.5rem}.search-container input{padding:.7rem .8rem .7rem 2.5rem;font-size:.9rem}.pdf-actions{flex-direction:column}.btn{width:100%}}.pdf-card{opacity:0;transform:translateY(20px);animation:fadeInUp .6s ease-out forwards}@keyframes fadeInUp{to{opacity:1;transform:translateY(0)}}@media (prefers-reduced-motion:reduce){.pdf-card{animation:none;opacity:1;transform:none}.loading i{animation:none}}.skip-link{position:absolute;top:-40px;left:6px;background:#4361ee;color:white;padding:8px;text-decoration:none;border-radius:4px;z-index:1000}.skip-link:focus{top:6px}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="alternate" type="application/rss+xml" title="PDF Library Updates" href="feed.xml">
    <!-- Resource Preloading -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js" as="script">
    <link rel="preload" as="font" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/webfonts/fa-solid-900.woff2" type="font/woff2" crossorigin>
</head>
<body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header>
        <div class="header-content">
            <div class="logo-container">
                <div class="logo" role="banner">
                    <i class="fas fa-file-pdf" aria-hidden="true"></i>
                    <h1>PDF Library</h1>
                </div>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
                    <i class="fas fa-moon" aria-hidden="true"></i>
                </button>
            </div>
            <div class="search-container">
                <i class="fas fa-search" aria-hidden="true"></i>
                <input type="text" id="searchInput" placeholder="Search PDFs by title, description, or category..."
                       aria-label="Search PDFs">
            </div>
        </div>
    </header>

    <div class="controls" role="navigation" aria-label="Filters and sorting">
        <div class="filters" id="filtersContainer">
            <!-- Filters will be generated dynamically -->
        </div>
        <div class="sort-controls">
            <span class="sort-label">Sort by:</span>
            <select class="sort-select" id="sortSelect" aria-label="Sort PDFs by">
                <option value="title">Title</option>
                <option value="date">Date</option>
                <option value="size">Size</option>
            </select>
        </div>
    </div>

    <div class="container">
        <div class="stats" role="status">
            <div>
                <strong id="total-count" aria-live="polite">0</strong> PDFs available
                <span id="favorites-count" style="margin-left: 10px; display: none;">
                    (<button id="view-favorites" class="btn-link" style="background:none;border:none;color:#4361ee;cursor:pointer;text-decoration:underline;" aria-label="View all favorites">
                        <span id="fav-count">0</span> favorites
                    </button>)
                </span>
            </div>
            <div>
                <i class="fas fa-download" aria-hidden="true"></i> All files are free to download
            </div>
        </div>

        <!-- Upload section (will be shown if admin mode is enabled) -->
        <div class="upload-section" id="uploadSection" aria-live="polite">
            <h3><i class="fas fa-upload" aria-hidden="true"></i> Upload New PDF</h3>
            <p style="margin-bottom: 1rem; color: #6c757d;">
                Note: File upload requires backend integration. This is a placeholder for demonstration.
            </p>
            <div class="upload-form">
                <div class="upload-input">
                    <label for="pdfFile" class="sr-only">PDF File</label>
                    <input type="file" id="pdfFile" accept=".pdf" disabled aria-label="Select PDF file">
                </div>
                <div class="upload-input">
                    <label for="pdfTitle" class="sr-only">PDF Title</label>
                    <input type="text" id="pdfTitle" placeholder="PDF Title" disabled aria-label="PDF title">
                </div>
                <div class="upload-input">
                    <label for="pdfCategory" class="sr-only">PDF Category</label>
                    <select id="pdfCategory" disabled aria-label="PDF category">
                        <option value="manual">User Manual</option>
                        <option value="guide">Guide</option>
                        <option value="report">Report</option>
                        <option value="research">Research</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <button class="btn btn-primary" id="uploadBtn" disabled aria-label="Upload PDF">
                    <i class="fas fa-upload" aria-hidden="true"></i> Upload
                </button>
            </div>
        </div>

        <main id="main-content">
            <div class="pdf-grid" id="pdfGrid" role="region" aria-label="PDF library">
                <!-- Loading state will be shown here -->
                <div class="loading" role="status" aria-live="polite">
                    <i class="fas fa-spinner" aria-hidden="true"></i>
                    <p>Loading PDFs...</p>
                </div>
            </div>

            <div class="pagination" id="paginationContainer" role="navigation" aria-label="Pagination">
                <!-- Pagination will be generated here -->
            </div>
        </main>
    </div>

    <!-- PDF Preview Modal -->
    <div id="pdfModal" class="modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.8);z-index:1000;overflow:auto;">
        <div class="modal-content" style="background:#1e293b;margin:2% auto;padding:20px;width:90%;max-width:900px;border-radius:8px;position:relative;max-height:90vh;overflow:hidden;">
            <button class="close-modal" style="position:absolute;top:15px;right:20px;font-size:28px;font-weight:bold;color:#f1f5f9;cursor:pointer;background:none;border:none;">&times;</button>
            <div class="pdf-preview-container" style="display:flex;flex-direction:column;height:100%;">
                <div class="pdf-preview-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;padding-bottom:10px;border-bottom:1px solid #475569;">
                    <h3 class="pdf-preview-title" id="previewTitle" style="font-size:1.3rem;font-weight:600;color:#f1f5f9;">PDF Preview</h3>
                    <div class="pdf-preview-actions" style="display:flex;gap:10px;">
                        <button class="btn btn-primary" id="downloadPreviewBtn" style="padding:.6rem 1rem;border-radius:8px;font-weight:600;background-color:#4361ee;color:white;border:none;cursor:pointer;">
                            <i class="fas fa-download" aria-hidden="true"></i> Download
                        </button>
                    </div>
                </div>
                <div id="pdfViewer" style="width:100%;height:70vh;overflow:auto;background:white;border-radius:8px;"></div>
            </div>
        </div>
    </div>

    <footer role="contentinfo">
        <p>PDF Library &copy; <span id="currentYear">2023</span> | Built with GitHub Pages</p>
        <p>All PDFs are provided for educational and reference purposes only.</p>
        <p>
            <a href="feed.xml" style="color:#4361ee;text-decoration:none;" aria-label="RSS Feed">
                <i class="fas fa-rss" aria-hidden="true"></i> RSS Feed
            </a>
        </p>
    </footer>

    <!-- Google Analytics (add your GA ID) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YOUR-GA-ID"></script>
    <script>
        // Google Analytics setup
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YOUR-GA-ID');

        // Track PDF downloads
        function trackDownload(pdfTitle) {
            if (typeof gtag !== 'undefined') {
                gtag('event', 'download', {
                    'event_category': 'PDF',
                    'event_label': pdfTitle
                });
            }
        }
    </script>

    <!-- Full CSS for non-critical styles and dark theme -->
    <style id="full-styles">
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4ade80;
            --warning: #facc15;
            --danger: #f87171;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --border: #dee2e6;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --radius: 8px;
            --transition: all 0.3s ease;

            /* Light theme variables */
            --bg-color: #f5f7ff;
            --card-bg: white;
            --text-color: var(--dark);
            --text-secondary: var(--gray);
            --header-bg: linear-gradient(135deg, var(--primary), var(--secondary));
            --filter-bg: white;
            --input-bg: white;
            --input-border: var(--border);
            --input-placeholder: var(--gray);
        }

        .dark-theme {
            --bg-color: #121826;
            --card-bg: #1e293b;
            --text-color: #f1f5f9;
            --text-secondary: #94a3b8;
            --header-bg: linear-gradient(135deg, #3730a3, #1e1b4b);
            --filter-bg: #1e293b;
            --input-bg: #334155;
            --input-border: #475569;
            --input-placeholder: #94a3b8;
        }

        /* Accessibility: Focus styles */
        *:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        body.dark-theme {
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .dark-theme .stats,
        .dark-theme .pdf-card,
        .dark-theme .controls,
        .dark-theme .upload-section,
        .dark-theme .modal-content {
            background: var(--card-bg);
            color: var(--text-color);
        }

        .dark-theme .pdf-description,
        .dark-theme .pdf-meta,
        .dark-theme .sort-label,
        .dark-theme footer,
        .dark-theme .empty-state p,
        .dark-theme .error-state p {
            color: var(--text-secondary);
        }

        .dark-theme .search-container input {
            background-color: var(--input-bg);
            border-color: var(--input-border);
            color: var(--text-color);
        }

        .dark-theme .search-container input::placeholder {
            color: var(--input-placeholder);
        }

        .dark-theme .filter-btn,
        .dark-theme .sort-select {
            background-color: var(--input-bg);
            border-color: var(--input-border);
            color: var(--text-color);
        }

        .dark-theme .pdf-category {
            background-color: var(--input-bg);
            color: var(--text-color);
        }

        .dark-theme .btn-outline {
            color: var(--primary);
            border-color: var(--primary);
        }

        .dark-theme .btn-outline:hover {
            background-color: var(--input-bg);
        }

        .dark-theme .pdf-preview-header {
            border-bottom-color: #475569;
        }

        .dark-theme .close-modal {
            color: var(--text-color);
        }

        .dark-theme .close-modal:hover {
            color: var(--danger);
        }
    </style>

    <!-- Deferred Scripts - Non-critical JavaScript loaded after DOM -->
    <script>
        // Load PDF.js after DOM loads for better performance
        document.addEventListener('DOMContentLoaded', function() {
            // Set current year
            document.getElementById('currentYear').textContent = new Date().getFullYear();

            // Initialize PDF.js
            if (typeof pdfjsLib !== 'undefined') {
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            }

            // Initialize the application
            initApp();
        });

        // Main application state
        const state = {
            allPDFs: [],
            favorites: new Set(),
            currentPage: 1,
            itemsPerPage: 12,
            activeCategory: 'all',
            searchTerm: '',
            sortBy: 'title',
            isLoading: true,
            error: null,
            viewingFavorites: false
        };

        // DOM Elements
        let pdfGrid, searchInput, filtersContainer, sortSelect, themeToggle, totalCount, favCount, favoritesCountEl;
        let paginationContainer, uploadSection, pdfModal, closeBtn, previewTitle, downloadPreviewBtn, pdfViewer;
        let viewFavoritesBtn;

        // Initialize the application
        function initApp() {
            // Get DOM elements
            pdfGrid = document.getElementById('pdfGrid');
            searchInput = document.getElementById('searchInput');
            filtersContainer = document.getElementById('filtersContainer');
            sortSelect = document.getElementById('sortSelect');
            themeToggle = document.getElementById('themeToggle');
            totalCount = document.getElementById('total-count');
            favCount = document.getElementById('fav-count');
            favoritesCountEl = document.getElementById('favorites-count');
            paginationContainer = document.getElementById('paginationContainer');
            uploadSection = document.getElementById('uploadSection');
            pdfModal = document.getElementById('pdfModal');
            closeBtn = document.querySelector('.close-modal');
            previewTitle = document.getElementById('previewTitle');
            downloadPreviewBtn = document.getElementById('downloadPreviewBtn');
            pdfViewer = document.getElementById('pdfViewer');
            viewFavoritesBtn = document.getElementById('view-favorites');

            // Load favorites from localStorage
            loadFavorites();

            // Load PDFs and initialize
            loadPDFs().then(() => {
                renderFilters();
                renderPDFs();
                setupEventListeners();
                initTheme();
            }).catch(error => {
                console.error('Failed to load PDFs:', error);
                state.error = 'Failed to load PDF data. Please try again later.';
                renderErrorState();
            });
        }

        // Load PDFs with performance optimization and error handling
        async function loadPDFs() {
            try {
                state.isLoading = true;
                state.error = null;

                // Show loading state
                renderLoadingState();

                // Try to load from pdfs.json
                const response = await fetch('pdfs.json?_=' + Date.now());
                if (response.ok) {
                    const data = await response.json();
                    state.allPDFs = data.map((pdf, index) => ({
                        ...pdf,
                        id: pdf.id || `pdf-${index}`,
                        title: pdf.title || 'Untitled PDF',
                        description: pdf.description || 'No description available',
                        category: pdf.category || 'other',
                        size: pdf.size || 'Unknown',
                        pages: pdf.pages || 'Unknown',
                        date: pdf.date || new Date().toISOString().split('T')[0],
                        downloadUrl: pdf.downloadUrl || ''
                    }));
                } else {
                    state.allPDFs = generateSampleData();
                }

                totalCount.textContent = state.allPDFs.length;
                updateFavoritesCount();
                state.isLoading = false;

            } catch (error) {
                console.warn('Could not load pdfs.json, using sample ', error);
                state.allPDFs = generateSampleData();
                totalCount.textContent = state.allPDFs.length;
                updateFavoritesCount();
                state.isLoading = false;
            }
        }

        // Render loading state
        function renderLoadingState() {
            pdfGrid.innerHTML = `
                <div class="loading" role="status" aria-live="polite">
                    <i class="fas fa-spinner" aria-hidden="true"></i>
                    <p>Loading PDFs...</p>
                </div>
            `;
        }

        // Render error state
        function renderErrorState() {
            pdfGrid.innerHTML = `
                <div class="error-state" role="alert" aria-live="assertive">
                    <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
                    <h3>Oops! Something went wrong</h3>
                    <p>${state.error || 'Failed to load PDF data. Please refresh the page and try again.'}</p>
                    <button class="btn btn-primary" onclick="location.reload()" style="margin-top: 1rem;">
                        <i class="fas fa-redo" aria-hidden="true"></i> Try Again
                    </button>
                </div>
            `;
        }

        // Generate sample data
        function generateSampleData() {
            return [
                {
                    id: 'pdf-1',
                    title: "User Manual - XYZ Device",
                    description: "Complete user manual for the XYZ device with setup instructions and troubleshooting.",
                    category: "manual",
                    size: "2.4 MB",
                    pages: 42,
                    date: "2023-05-15",
                    downloadUrl: "pdfs/xyz-device-manual.pdf"
                },
                {
                    id: 'pdf-2',
                    title: "Beginner's Guide to Web Development",
                    description: "Comprehensive guide covering HTML, CSS, and JavaScript fundamentals for beginners.",
                    category: "guide",
                    size: "3.1 MB",
                    pages: 78,
                    date: "2023-02-28",
                    downloadUrl: "pdfs/web-dev-guide.pdf"
                },
                {
                    id: 'pdf-3',
                    title: "Annual Sustainability Report 2022",
                    description: "Our company's environmental impact and sustainability initiatives for 2022.",
                    category: "report",
                    size: "5.7 MB",
                    pages: 120,
                    date: "2023-01-10",
                    downloadUrl: "pdfs/sustainability-report-2022.pdf"
                },
                {
                    id: 'pdf-4',
                    title: "Machine Learning Research Paper",
                    description: "Latest findings on neural network optimization techniques and applications.",
                    category: "research",
                    size: "1.8 MB",
                    pages: 24,
                    date: "2023-06-22",
                    downloadUrl: "pdfs/ml-research-paper.pdf"
                },
                {
                    id: 'pdf-5',
                    title: "Cookbook - Mediterranean Recipes",
                    description: "Collection of authentic Mediterranean recipes with nutritional information.",
                    category: "other",
                    size: "4.2 MB",
                    pages: 65,
                    date: "2023-04-05",
                    downloadUrl: "pdfs/mediterranean-cookbook.pdf"
                },
                {
                    id: 'pdf-6',
                    title: "Advanced JavaScript Patterns",
                    description: "Deep dive into advanced JavaScript design patterns and best practices.",
                    category: "guide",
                    size: "2.9 MB",
                    pages: 56,
                    date: "2023-03-18",
                    downloadUrl: "pdfs/js-patterns.pdf"
                },
                {
                    id: 'pdf-7',
                    title: "Cloud Computing Best Practices",
                    description: "Guidelines for secure and efficient cloud infrastructure management.",
                    category: "guide",
                    size: "3.8 MB",
                    pages: 89,
                    date: "2023-07-10",
                    downloadUrl: "pdfs/cloud-best-practices.pdf"
                },
                {
                    id: 'pdf-8',
                    title: "Financial Report Q2 2023",
                    description: "Quarterly financial performance and analysis.",
                    category: "report",
                    size: "2.1 MB",
                    pages: 35,
                    date: "2023-07-15",
                    downloadUrl: "pdfs/financial-report-q2-2023.pdf"
                }
            ];
        }

        // Load favorites from localStorage
        function loadFavorites() {
            try {
                const saved = localStorage.getItem('pdfFavorites');
                if (saved) {
                    const favoritesArray = JSON.parse(saved);
                    state.favorites = new Set(favoritesArray);
                }
            } catch (e) {
                console.warn('Could not load favorites:', e);
            }
        }

        // Save favorites to localStorage
        function saveFavorites() {
            try {
                localStorage.setItem('pdfFavorites', JSON.stringify(Array.from(state.favorites)));
                updateFavoritesCount();
            } catch (e) {
                console.warn('Could not save favorites:', e);
            }
        }

        // Update favorites count display
        function updateFavoritesCount() {
            const count = state.favorites.size;
            favCount.textContent = count;
            favoritesCountEl.style.display = count > 0 ? 'inline' : 'none';
        }

        // Toggle favorite
        function toggleFavorite(pdfId) {
            if (state.favorites.has(pdfId)) {
                state.favorites.delete(pdfId);
            } else {
                state.favorites.add(pdfId);
            }
            saveFavorites();
            renderPDFs(); // Re-render to update favorite icons
        }

        // View all favorites
        function viewAllFavorites() {
            state.viewingFavorites = true;
            state.activeCategory = 'all';
            state.searchTerm = '';
            state.currentPage = 1;

            // Update UI to show we're viewing favorites
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-pressed', 'false');
            });

            renderPDFs();
        }

        // Get unique categories
        function getUniqueCategories(pdfs) {
            const categories = new Set(pdfs.map(pdf => pdf.category));
            return ['all', ...Array.from(categories)];
        }

        // Render filters
        function renderFilters() {
            const categories = getUniqueCategories(state.allPDFs);
            filtersContainer.innerHTML = categories.map(category => `
                <button class="filter-btn ${category === state.activeCategory ? 'active' : ''}"
                        data-category="${category}"
                        aria-pressed="${category === state.activeCategory}">
                    ${formatCategory(category)}
                </button>
            `).join('');
        }

        // Render PDFs with pagination and favorites view
        function renderPDFs() {
            let filteredPDFs;

            if (state.viewingFavorites) {
                // Show only favorites
                filteredPDFs = state.allPDFs.filter(pdf => state.favorites.has(pdf.id));
            } else {
                // Apply normal filtering
                filteredPDFs = state.allPDFs.filter(pdf => {
                    const matchesSearch = pdf.title.toLowerCase().includes(state.searchTerm) ||
                                         pdf.description.toLowerCase().includes(state.searchTerm) ||
                                         pdf.category.toLowerCase().includes(state.searchTerm);

                    const matchesCategory = state.activeCategory === 'all' || pdf.category === state.activeCategory;

                    return matchesSearch && matchesCategory;
                });
            }

            // Sort PDFs
            filteredPDFs = sortPDFs(filteredPDFs, state.sortBy);

            // Apply pagination
            const totalPages = Math.ceil(filteredPDFs.length / state.itemsPerPage);
            const startIndex = (state.currentPage - 1) * state.itemsPerPage;
            const paginatedPDFs = filteredPDFs.slice(startIndex, startIndex + state.itemsPerPage);

            // Render PDF cards or empty state
            if (paginatedPDFs.length === 0) {
                if (state.viewingFavorites) {
                    pdfGrid.innerHTML = `
                        <div class="empty-state" role="status" aria-live="polite">
                            <i class="fas fa-star" aria-hidden="true"></i>
                            <h3>No favorites yet</h3>
                            <p>Click the star icon on any PDF to add it to your favorites!</p>
                        </div>
                    `;
                } else {
                    renderEmptyState();
                }
            } else {
                pdfGrid.innerHTML = paginatedPDFs.map((pdf, index) => `
                    <article class="pdf-card" data-category="${pdf.category}" data-title="${pdf.title}" data-date="${pdf.date}" data-size="${pdf.size}">
                        <div class="pdf-icon">
                            <button class="favorite-btn ${state.favorites.has(pdf.id) ? 'favorited' : ''}"
                                    data-pdf-id="${pdf.id}"
                                    title="Add to favorites"
                                    aria-label="${state.favorites.has(pdf.id) ? 'Remove from favorites' : 'Add to favorites'}">
                                <i class="fas fa-star" aria-hidden="true"></i>
                            </button>
                            <i class="fas fa-file-pdf" aria-hidden="true"></i>
                        </div>
                        <div class="pdf-content">
                            <h3 class="pdf-title">${escapeHtml(pdf.title)}</h3>
                            <div class="pdf-meta">
                                <span>${pdf.pages} pages</span>
                                <span>${pdf.size}</span>
                            </div>
                            <span class="pdf-category">${formatCategory(pdf.category)}</span>
                            <p class="pdf-description">${escapeHtml(pdf.description)}</p>
                            <div class="pdf-actions">
                                <a href="${pdf.downloadUrl}" class="btn btn-primary download-btn" data-title="${pdf.title}" download
                                   aria-label="Download ${pdf.title}">
                                    <i class="fas fa-download" aria-hidden="true"></i> Download
                                </a>
                                <button class="btn btn-outline preview-btn" data-url="${pdf.downloadUrl}" data-title="${pdf.title}"
                                        aria-label="Preview ${pdf.title}">
                                    <i class="fas fa-eye" aria-hidden="true"></i> Preview
                                </button>
                            </div>
                        </div>
                    </article>
                `).join('');
            }

            // Render pagination
            renderPagination(totalPages);

            // Add event listeners to new elements
            addPDFEventListeners();
        }

        // Render empty state
        function renderEmptyState() {
            pdfGrid.innerHTML = `
                <div class="empty-state" role="status" aria-live="polite">
                    <i class="fas fa-file-search" aria-hidden="true"></i>
                    <h3>No PDFs found</h3>
                    <p>Try adjusting your search terms or filter selection</p>
                </div>
            `;
        }

        // Render pagination controls
        function renderPagination(totalPages) {
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }

            const maxVisiblePages = 5;
            let startPage = Math.max(1, state.currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            let paginationHTML = '';

            // Previous button
            if (state.currentPage > 1) {
                paginationHTML += `<button class="page-btn" data-page="${state.currentPage - 1}" aria-label="Previous page">Previous</button>`;
            }

            // First page
            if (startPage > 1) {
                paginationHTML += `<button class="page-btn" data-page="1" aria-label="Go to page 1">1</button>`;
                if (startPage > 2) {
                    paginationHTML += `<span class="page-btn" style="background: none; border: none;" aria-hidden="true">...</span>`;
                }
            }

            // Visible pages
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `<button class="page-btn ${i === state.currentPage ? 'active' : ''}" data-page="${i}"
                                         aria-label="Go to page ${i}" aria-current="${i === state.currentPage ? 'page' : false}">${i}</button>`;
            }

            // Last page
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `<span class="page-btn" style="background: none; border: none;" aria-hidden="true">...</span>`;
                }
                paginationHTML += `<button class="page-btn" data-page="${totalPages}" aria-label="Go to page ${totalPages}">${totalPages}</button>`;
            }

            // Next button
            if (state.currentPage < totalPages) {
                paginationHTML += `<button class="page-btn" data-page="${state.currentPage + 1}" aria-label="Next page">Next</button>`;
            }

            paginationContainer.innerHTML = paginationHTML;
        }

        // Add event listeners to PDF elements
        function addPDFEventListeners() {
            // Favorite buttons
            document.querySelectorAll('.favorite-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const pdfId = btn.dataset.pdfId;
                    toggleFavorite(pdfId);
                });
            });

            // Download buttons
            document.querySelectorAll('.download-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const title = btn.dataset.title;
                    trackDownload(title);
                });
            });

            // Preview buttons
            document.querySelectorAll('.preview-btn').forEach(btn => {
                btn.addEventListener('click', handlePreview);
            });
        }

        // Handle preview
        function handlePreview(e) {
            const url = e.currentTarget.dataset.url;
            const title = e.currentTarget.dataset.title;
            openPDFPreview(url, title);
        }

        // Open PDF preview modal
        async function openPDFPreview(url, title) {
            currentPDFUrl = url;
            previewTitle.textContent = title;
            pdfModal.style.display = 'block';

            try {
                // Clear previous content
                pdfViewer.innerHTML = '<div style="text-align: center; padding: 20px; color: #6c757d;">Loading PDF...</div>';

                // Load PDF
                if (typeof pdfjsLib === 'undefined') {
                    pdfViewer.innerHTML = '<div style="text-align: center; padding: 20px; color: #f87171;"><i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px;"></i><p>PDF.js not loaded. Try downloading instead.</p></div>';
                    return;
                }

                const loadingTask = pdfjsLib.getDocument(url);
                const pdf = await loadingTask.promise;

                // Clear viewer
                pdfViewer.innerHTML = '';

                // Render first page
                const page = await pdf.getPage(1);
                const scale = 1.5;
                const viewport = page.getViewport({ scale });

                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                pdfViewer.appendChild(canvas);

                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                await page.render(renderContext).promise;

                // Add navigation for multi-page PDFs
                if (pdf.numPages > 1) {
                    const nav = document.createElement('div');
                    nav.style.marginTop = '15px';
                    nav.style.textAlign = 'center';
                    nav.innerHTML = `
                        <span style="color: #f1f5f9;">Page 1 of ${pdf.numPages}</span>
                        <button id="nextPageBtn" style="margin-left: 10px; padding: 5px 10px; background: #4361ee; color: white; border: none; border-radius: 4px; cursor: pointer;">Next Page</button>
                    `;
                    pdfViewer.appendChild(nav);

                    document.getElementById('nextPageBtn').addEventListener('click', () => {
                        renderPage(pdf, 2, scale);
                    });
                }
            } catch (error) {
                pdfViewer.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #f87171;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>Error loading PDF: ${error.message}</p>
                        <p>Try downloading the file instead.</p>
                    </div>
                `;
                console.error('Error loading PDF:', error);
            }
        }

        // Render a specific page
        async function renderPage(pdf, pageNumber, scale) {
            try {
                const page = await pdf.getPage(pageNumber);
                const viewport = page.getViewport({ scale });

                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                // Replace existing canvas
                const oldCanvas = pdfViewer.querySelector('canvas');
                if (oldCanvas) {
                    pdfViewer.replaceChild(canvas, oldCanvas);
                }

                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                await page.render(renderContext).promise;

                // Update page indicator
                const nav = pdfViewer.querySelector('div[style*="text-align: center"]');
                if (nav) {
                    nav.innerHTML = `
                        <span style="color: #f1f5f9;">Page ${pageNumber} of ${pdf.numPages}</span>
                        ${pageNumber < pdf.numPages ?
                            `<button id="nextPageBtn" style="margin-left: 10px; padding: 5px 10px; background: #4361ee; color: white; border: none; border-radius: 4px; cursor: pointer;">Next Page</button>` :
                            ''}
                        ${pageNumber > 1 ?
                            `<button id="prevPageBtn" style="margin-left: 10px; padding: 5px 10px; background: #4361ee; color: white; border: none; border-radius: 4px; cursor: pointer;">Previous Page</button>` :
                            ''}
                    `;

                    if (pageNumber < pdf.numPages) {
                        document.getElementById('nextPageBtn').addEventListener('click', () => {
                            renderPage(pdf, pageNumber + 1, scale);
                        });
                    }
                    if (pageNumber > 1) {
                        document.getElementById('prevPageBtn').addEventListener('click', () => {
                            renderPage(pdf, pageNumber - 1, scale);
                        });
                    }
                }
            } catch (error) {
                console.error('Error rendering page:', error);
            }
        }

        // Close modal
        function closeModal() {
            pdfModal.style.display = 'none';
            pdfViewer.innerHTML = '';
            currentPDFUrl = '';
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search with debounced input
            searchInput.addEventListener('input', debounce((e) => {
                state.searchTerm = e.target.value.toLowerCase();
                state.currentPage = 1;
                state.viewingFavorites = false; // Exit favorites view when searching
                renderPDFs();
            }, 300));

            // Filters
            filtersContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('filter-btn')) {
                    state.activeCategory = e.target.dataset.category;
                    state.currentPage = 1;
                    state.viewingFavorites = false; // Exit favorites view when filtering
                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                        btn.setAttribute('aria-pressed', 'false');
                    });
                    e.target.classList.add('active');
                    e.target.setAttribute('aria-pressed', 'true');
                    renderPDFs();
                }
            });

            // Sorting
            sortSelect.addEventListener('change', (e) => {
                state.sortBy = e.target.value;
                state.currentPage = 1;
                renderPDFs();
            });

            // Pagination
            paginationContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('page-btn') && e.target.dataset.page) {
                    state.currentPage = parseInt(e.target.dataset.page);
                    renderPDFs();
                }
            });

            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);

            // View favorites button
            if (viewFavoritesBtn) {
                viewFavoritesBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    viewAllFavorites();
                });
            }

            // Modal close
            if (closeBtn) {
                closeBtn.addEventListener('click', closeModal);
            }
            if (pdfModal) {
                pdfModal.addEventListener('click', (e) => {
                    if (e.target === pdfModal) closeModal();
                });
            }

            // Download preview button
            if (downloadPreviewBtn) {
                downloadPreviewBtn.addEventListener('click', () => {
                    if (currentPDFUrl) {
                        window.open(currentPDFUrl, '_blank');
                    }
                });
            }
        }

        // Format category for display
        function formatCategory(category) {
            if (category === 'all') return 'All Categories';

            const categoryMap = {
                'manual': 'User Manual',
                'guide': 'Guide',
                'report': 'Report',
                'research': 'Research',
                'other': 'Other'
            };
            return categoryMap[category] || category.charAt(0).toUpperCase() + category.slice(1);
        }

        // Sort PDFs
        function sortPDFs(pdfs, sortBy) {
            return [...pdfs].sort((a, b) => {
                switch (sortBy) {
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'date':
                        return new Date(b.date) - new Date(a.date);
                    case 'size':
                        const sizeA = parseFloat(a.size) || 0;
                        const sizeB = parseFloat(b.size) || 0;
                        return sizeB - sizeA;
                    default:
                        return 0;
                }
            });
        }

        // Toggle dark mode
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');
            localStorage.setItem('darkMode', isDark);
            themeToggle.innerHTML = isDark ? '<i class="fas fa-sun" aria-hidden="true"></i>' : '<i class="fas fa-moon" aria-hidden="true"></i>';
            themeToggle.setAttribute('aria-label', isDark ? 'Switch to light mode' : 'Switch to dark mode');
        }

        // Initialize theme
        function initTheme() {
            const savedTheme = localStorage.getItem('darkMode') === 'true';
            if (savedTheme) {
                document.body.classList.add('dark-theme');
                themeToggle.innerHTML = '<i class="fas fa-sun" aria-hidden="true"></i>';
                themeToggle.setAttribute('aria-label', 'Switch to light mode');
            } else {
                themeToggle.setAttribute('aria-label', 'Switch to dark mode');
            }
        }

        // Debounce function for performance
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Current PDF URL for preview
        let currentPDFUrl = '';
    </script>
</body>
</html>
